{
  "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
  "version": "1.0",
  "type": "AdaptiveCard",
  "body": [
    {
      "type": "Container",
      "color": "accent",
      "spacing": "small",
      "items": [
        {
          "type": "TextBlock",
          "text": "Release notes for {{ data.name }}",
          "weight": "bolder"
        },
        {
          "type": "TextBlock",
          "text": "Sprint ended on: {{ data.endDate }}"
        }
      ]
    },
    {
      "type": "Container",
      "color": "warning",
      "spacing": "small",
      "showWhen": "!data.stories.length",
      "items": [
        {
          "type": "TextBlock",
          "text": "There are no release notes for this iteration"
        }
      ]
    },
    {
      "type": "Container",
      "showWhen": "data.stories.length",
      "bordered": true,
      "shadowed": true,
      "spacing": "none",
      "items": [
        {
          "id": "storiesTable",
          "type": "MarkupTable",
          "arrayPath": "data.stories",
          "columns": [
            {
              "title": "Type",
              "value": "{{ item.storyType }}"
            },
            {
              "title": "Note",
              "value": "{{ item.releaseNote }}"
            }
          ]
        }
      ]
    },
    {
      "type": "Container",
      "showWhen": "data.stories.filter(r => r.storyType === 'feature').length > 0",
      "bordered": true,
      "shadowed": true,
      "spacing": "none",
      "items": [
        {
          "type": "TextBlock",
          "text": "Features",
          "weight": "bolder",
          "size": "medium"
        },
        {
          "id": "featuresList",
          "type": "List",
          "arrayPath": "data.stories.filter(r => r.storyType === 'feature')",
          "templates": {
            "label": "{{ item.releaseNote }}"
          }
        }
      ]
    },
    {
      "type": "Container",
      "showWhen": "data.stories.filter(r => r.storyType === 'bug').length > 0",
      "bordered": true,
      "shadowed": true,
      "spacing": "none",
      "items": [
        {
          "type": "TextBlock",
          "text": "Bugs",
          "weight": "bolder",
          "size": "medium"
        },
        {
          "id": "bugsList",
          "type": "List",
          "arrayPath": "data.stories.filter(r => r.storyType === 'bug')",
          "templates": {
            "label": "{{ item.releaseNote }}"
          }
        }
      ]
    },
    {
      "type": "Container",
      "showWhen": "data.stories.filter(r => r.storyType === 'chore').length > 0",
      "bordered": true,
      "shadowed": true,
      "spacing": "none",
      "items": [
        {
          "type": "TextBlock",
          "text": "Chores",
          "weight": "bolder",
          "size": "medium"
        },
        {
          "id": "choresList",
          "type": "List",
          "arrayPath": "data.stories.filter(r => r.storyType === 'chore')",
          "templates": {
            "label": "{{ item.releaseNote }}"
          }
        }
      ]
    }
  ],
  "actions": [
    {
      "type": "Action.Cancel",
      "title": "Close"
    },
    {
      "showWhen": "data.stories.length",
      "type": "Action.PushCard",
      "title": "Download PDF",
      "stateMachineName": "system_downloadReleaseNotes_1_0",
      "input": {
        "id": "$.iterationId",
        "features": "$.features",
        "bugs": "$.bugs",
        "chores": "$.chores",
        "iterationName": "$.name",
        "endDate": "$.endDate",
        "exportType": "PDF"
      }
    },
    {
      "showWhen": "data.stories.length",
      "type": "Action.PushCard",
      "title": "Download HTML",
      "stateMachineName": "system_downloadReleaseNotes_1_0",
      "input": {
        "id": "$.iterationId",
        "features": "$.features",
        "bugs": "$.bugs",
        "chores": "$.chores",
        "iterationName": "$.name",
        "endDate": "$.endDate",
        "exportType": "HTML"
      }
    }
  ],
  "templateMeta": {
    "name": "release-note-view",
    "title": "Release Notes",
    "category": "system"
  }
}
